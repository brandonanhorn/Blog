<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />


  <title>Pymc3 and the NBA</title>


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="./" rel="canonical" />

  <!-- Feed -->
        <link href="https://brandonanhorn.github.io/Blog/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="a BA blog Full Atom Feed" />
          <link href="https://brandonanhorn.github.io/Blog/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="a BA blog Categories Atom Feed" />

  <link href="./theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="./theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


  <link href="./Fifth blog.html" rel="canonical" />

    <meta name="description" content="Welcome back to the fifth blog in the BA blog series. The theme of today's blog is, by far, one of my favourite topics - sports. I will...">

    <meta name="author" content="Brandon Anhorn">





<!-- Open Graph -->
<meta property="og:site_name" content="a BA blog"/>
<meta property="og:title" content="Pymc3 and the NBA"/>
<meta property="og:description" content="Welcome back to the fifth blog in the BA blog series. The theme of today's blog is, by far, one of my favourite topics - sports. I will..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./Fifth blog.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2020-02-10 00:00:00-05:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/brandon-anhorn.html">
<meta property="article:section" content="misc"/>
<meta property="og:image" content="./theme/images/post-bg.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Pymc3 and the NBA",
  "headline": "Pymc3 and the NBA",
  "datePublished": "2020-02-10 00:00:00-05:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Brandon Anhorn",
    "url": "./author/brandon-anhorn.html"
  },
  "image": "./theme/images/post-bg.jpg",
  "url": "./Fifth blog.html",
  "description": "Welcome back to the fifth blog in the BA blog series. The theme of today's blog is, by far, one of my favourite topics - sports. I will..."
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>


    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span id="home-button" class="nav-button">
                <a class="home-button" href="./" title="Home"><i class="ic ic-arrow-left"></i> Home</a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Pymc3 and the NBA</h1>
        <!-- TODO : Proper class for headline -->
        <span class="post-meta">
                <a href="./author/brandon-anhorn.html">Brandon Anhorn</a>
            | <time datetime="Mon 10 February 2020">Mon 10 February 2020</time>
        </span>
        <!-- TODO : Modified check -->
            <div class="post-cover cover" style="background-image: url('./theme/images/post-bg.jpg')">
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>Welcome back to the fifth blog in the BA blog series. The theme of today's blog is, by far, one of my favourite topics - sports. I will demonstrate the power that pymc3, a Bayesian statistical modelling package for python, has in the data science field.</p>
<p>To begin, we are going to import the usual suspects, along with my favourite way to play with NBA sports data, the nba_api package.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">nba_api</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pymc3</span> <span class="kn">as</span> <span class="nn">pm</span>

<span class="kn">from</span> <span class="nn">nba_api.stats.static</span> <span class="kn">import</span> <span class="n">teams</span>
<span class="kn">from</span> <span class="nn">nba_api.stats.endpoints</span> <span class="kn">import</span> <span class="n">leaguegamefinder</span>
<span class="kn">from</span> <span class="nn">nba_api.stats.endpoints</span> <span class="kn">import</span> <span class="n">teamyearbyyearstats</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
</pre></div>


<p>This next step is calling the three teams we are going to be looking at closer today.</p>
<p>df will be the Dallas Mavericks
df1 will be the San Antonio Spurs
df2 will be the Utah Jazz</p>
<div class="highlight"><pre><span></span><span class="n">team_dict</span> <span class="o">=</span> <span class="n">teams</span><span class="o">.</span><span class="n">get_teams</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">mavericks</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">team_dict</span> <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Dallas Mavericks&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">spurs</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">team_dict</span> <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;San Antonio Spurs&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">raptors</span> <span class="o">=</span> <span class="p">[</span><span class="n">team</span> <span class="k">for</span> <span class="n">team</span> <span class="ow">in</span> <span class="n">team_dict</span> <span class="k">if</span> <span class="n">team</span><span class="p">[</span><span class="s1">&#39;full_name&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;Toronto Raptors&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">mavericks_id</span> <span class="o">=</span> <span class="n">mavericks</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">spurs_id</span> <span class="o">=</span> <span class="n">spurs</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
<span class="n">raptors_id</span> <span class="o">=</span> <span class="n">raptors</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">teamyearbyyearstats</span><span class="o">.</span><span class="n">TeamYearByYearStats</span><span class="p">(</span><span class="n">mavericks_id</span><span class="p">)</span><span class="o">.</span><span class="n">get_data_frames</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df1</span> <span class="o">=</span> <span class="n">teamyearbyyearstats</span><span class="o">.</span><span class="n">TeamYearByYearStats</span><span class="p">(</span><span class="n">spurs_id</span><span class="p">)</span><span class="o">.</span><span class="n">get_data_frames</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">teamyearbyyearstats</span><span class="o">.</span><span class="n">TeamYearByYearStats</span><span class="p">(</span><span class="n">raptors_id</span><span class="p">)</span><span class="o">.</span><span class="n">get_data_frames</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>


<p>The next two steps are a little cleaning to make the data more workable.</p>
<div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df1</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">df2</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df1</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df1</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>


<p>Now, let's plot the three teams using seaborn.</p>
<p>Notice that we are plotting each year the franchise has been around on the X-axis and the number of wins on the Y-axis.</p>
<div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Dallas Mavericks&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;San Antonio Spurs&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Toronto Raptors&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/output_12_0.png"></p>
<p>Now the real magic begins - bring in pymc3!</p>
<p>The first pymc3 model we are going to run is on the Dallas Mavericks. We are going to run a model that has to lambdas, which you can see run using Normal distribution. These lambdas will measure each season wins total and try to notice a "change."</p>
<p>The change is the other import part of this model and its called the tau. The tau will return a number that represents when the model identifies a shift.</p>
<p>Running our first model:</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">lambda_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_1&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">lambda_2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_2&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">))</span> <span class="c1"># Index</span>
    <span class="n">lambda_</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">tau</span> <span class="o">&gt;</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lambda_1</span><span class="p">,</span> <span class="n">lambda_2</span><span class="p">)</span>

    <span class="n">observation</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">])</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="nv">Multiprocess</span> <span class="nv">sampling</span> <span class="ss">(</span><span class="mi">2</span> <span class="nv">chains</span> <span class="nv">in</span> <span class="mi">2</span> <span class="nv">jobs</span><span class="ss">)</span>
<span class="nv">CompoundStep</span>
<span class="o">&gt;</span><span class="nv">NUTS</span>: [<span class="nv">lambda_2</span>, <span class="nv">lambda_1</span>]
<span class="o">&gt;</span><span class="nv">Metropolis</span>: [<span class="nv">tau</span>]
<span class="nv">Sampling</span> <span class="mi">2</span> <span class="nv">chains</span>, <span class="mi">0</span> <span class="nv">divergences</span>: <span class="mi">100</span><span class="o">%|</span>██████████<span class="o">|</span> <span class="mi">22000</span><span class="o">/</span><span class="mi">22000</span> [<span class="mi">00</span>:<span class="mi">15</span><span class="o">&lt;</span><span class="mi">00</span>:<span class="mi">00</span>, <span class="mi">1400</span>.<span class="mi">18</span><span class="nv">draws</span><span class="o">/</span><span class="nv">s</span>]
<span class="nv">The</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">effective</span> <span class="nv">samples</span> <span class="nv">is</span> <span class="nv">smaller</span> <span class="nv">than</span> <span class="mi">10</span><span class="o">%</span> <span class="k">for</span> <span class="nv">some</span> <span class="nv">parameters</span>.
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">## Dirk</span>
<span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hpd_3%</th>
      <th>hpd_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lambda_1</td>
      <td>31.872</td>
      <td>0.282</td>
      <td>31.367</td>
      <td>32.425</td>
      <td>0.005</td>
      <td>0.004</td>
      <td>2730.0</td>
      <td>2716.0</td>
      <td>2894.0</td>
      <td>5336.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>lambda_2</td>
      <td>47.746</td>
      <td>0.270</td>
      <td>47.268</td>
      <td>48.282</td>
      <td>0.005</td>
      <td>0.004</td>
      <td>2776.0</td>
      <td>2768.0</td>
      <td>2956.0</td>
      <td>5347.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>tau</td>
      <td>19.215</td>
      <td>0.411</td>
      <td>19.000</td>
      <td>20.000</td>
      <td>0.012</td>
      <td>0.009</td>
      <td>1098.0</td>
      <td>1098.0</td>
      <td>1098.0</td>
      <td>1098.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Now for those of you that follow the NBA, you will have heard of someone called Dirk Nowitzki. He played his entire career for the Mavericks and was a perennial all start, which brought a championship to that team.</p>
<p>From the above summary, you can see that our model noticed a change on the 19th bar of the Dallas graph which correlates to the 98-99 season.</p>
<p>Drumroll, please, Dirk Nowitzki was drafted by the Dallas Mavericks in 98-99. Add the shocked monkey face from the previous blog. That is amazing that pymc3 noticed that something significant happened at this time.</p>
<p>Still a skeptic of pymc3, let's do another.</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">lambda_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_1&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">lambda_2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_2&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df1</span><span class="p">))</span> <span class="c1"># Index</span>
    <span class="n">lambda_</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">tau</span> <span class="o">&gt;</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lambda_1</span><span class="p">,</span> <span class="n">lambda_2</span><span class="p">)</span>

    <span class="n">observation</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">df1</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">])</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Multiprocess</span><span class="w"> </span><span class="n">sampling</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">chains</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">jobs</span><span class="p">)</span><span class="w"></span>
<span class="n">CompoundStep</span><span class="w"></span>
<span class="o">&gt;</span><span class="nl">NUTS</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">lambda_2, lambda_1</span><span class="o">]</span><span class="w"></span>
<span class="o">&gt;</span><span class="nl">Metropolis</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">tau</span><span class="o">]</span><span class="w"></span>
<span class="n">Sampling</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">chains</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nl">divergences</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%|</span><span class="err">██████████</span><span class="o">|</span><span class="w"> </span><span class="mi">22000</span><span class="o">/</span><span class="mi">22000</span><span class="w"> </span><span class="o">[</span><span class="n">00:16&lt;00:00, 1373.07draws/s</span><span class="o">]</span><span class="w"></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="c1">## Timmy D</span>
<span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hpd_3%</th>
      <th>hpd_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lambda_1</td>
      <td>44.651</td>
      <td>0.212</td>
      <td>44.255</td>
      <td>45.042</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>18282.0</td>
      <td>18259.0</td>
      <td>18285.0</td>
      <td>12643.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>lambda_2</td>
      <td>55.134</td>
      <td>0.219</td>
      <td>54.725</td>
      <td>55.547</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>18181.0</td>
      <td>18181.0</td>
      <td>18175.0</td>
      <td>13052.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>tau</td>
      <td>23.000</td>
      <td>0.000</td>
      <td>23.000</td>
      <td>23.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>You notice from the summary that the tau is at 23 now, which correlates to the 98-99 season. That was the second year for arguably the best power forward to ever play in the NBA - Tim Duncan. He also went on to win multiple championships for his San Antonio Spurs.</p>
<p>Notice the only difference from the first model is the increase upper limit for tau because this team was around longer than the Dallas Mavericks.</p>
<p>Do you want to see one more? Of course, you do.</p>
<div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">()</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">lambda_1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_1&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">lambda_2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s1">&#39;lambda_2&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">DiscreteUniform</span><span class="p">(</span><span class="s2">&quot;tau&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df2</span><span class="p">))</span> <span class="c1"># Index</span>
    <span class="n">lambda_</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">math</span><span class="o">.</span><span class="n">switch</span><span class="p">(</span><span class="n">tau</span> <span class="o">&gt;</span> <span class="n">idx</span><span class="p">,</span> <span class="n">lambda_1</span><span class="p">,</span> <span class="n">lambda_2</span><span class="p">)</span>

    <span class="n">observation</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">df2</span><span class="p">[</span><span class="s1">&#39;wins&#39;</span><span class="p">])</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10000</span><span class="p">,</span> <span class="n">tune</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">chains</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">Multiprocess</span><span class="w"> </span><span class="n">sampling</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="w"> </span><span class="n">chains</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">jobs</span><span class="p">)</span><span class="w"></span>
<span class="n">CompoundStep</span><span class="w"></span>
<span class="o">&gt;</span><span class="nl">NUTS</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">lambda_2, lambda_1</span><span class="o">]</span><span class="w"></span>
<span class="o">&gt;</span><span class="nl">Metropolis</span><span class="p">:</span><span class="w"> </span><span class="o">[</span><span class="n">tau</span><span class="o">]</span><span class="w"></span>
<span class="n">Sampling</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="n">chains</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="nl">divergences</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="o">%|</span><span class="err">██████████</span><span class="o">|</span><span class="w"> </span><span class="mi">22000</span><span class="o">/</span><span class="mi">22000</span><span class="w"> </span><span class="o">[</span><span class="n">00:15&lt;00:00, 1383.41draws/s</span><span class="o">]</span><span class="w"></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pm</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">trace</span><span class="p">)</span>
</pre></div>


<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>sd</th>
      <th>hpd_3%</th>
      <th>hpd_97%</th>
      <th>mcse_mean</th>
      <th>mcse_sd</th>
      <th>ess_mean</th>
      <th>ess_sd</th>
      <th>ess_bulk</th>
      <th>ess_tail</th>
      <th>r_hat</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>lambda_1</td>
      <td>30.995</td>
      <td>0.305</td>
      <td>30.429</td>
      <td>31.569</td>
      <td>0.002</td>
      <td>0.002</td>
      <td>18299.0</td>
      <td>18294.0</td>
      <td>18313.0</td>
      <td>14028.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>lambda_2</td>
      <td>42.921</td>
      <td>0.268</td>
      <td>42.425</td>
      <td>43.425</td>
      <td>0.002</td>
      <td>0.001</td>
      <td>18507.0</td>
      <td>18507.0</td>
      <td>18513.0</td>
      <td>14695.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <td>tau</td>
      <td>11.000</td>
      <td>0.000</td>
      <td>11.000</td>
      <td>11.000</td>
      <td>0.000</td>
      <td>0.000</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>20000.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>

<p>This last one has a special place in my heart as a Canadian. The tau is 11, which correlates to the 2006-07 season for the Raptors. The first time the Raptors won a division title and maybe the season that built the culture, which helped them win the NBA championship in the 2018-19 season.</p>
<p>And with that, I hope you see the power of pymc3. It needs minimal inputs to make it work and is immensely powerful.</p>
<p>Go forth and use it for good!</p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Pymc3 and the NBA&amp;url=./Fifth blog.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=./Fifth blog.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=./Fifth blog.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>


                <div class="clear"></div>


                </section>


                <aside class="post-nav">
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script type="text/javascript" src="./theme/js/script.js"></script>

</body>
</html>
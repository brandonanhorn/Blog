<!DOCTYPE html>
<html lang="en">
<head>
 <title>Numba</title>
 <!-- Latest compiled and minified CSS -->
 <link href="css/clean-blog.min.css" rel="stylesheet">
 <div class="container">
  <h1><a href=".">a BA blog</a></h1>
 </div>
</head>
<body>
 <div class="container">
<div class="row">
 <div class="col-md-8">
  <h3>Numba</h3>
  <label>2020-01-29</label>
  <p>Today's blog post will be on Numba, a python package that is used for speeding up loops, NumPy functions and NumPy broadcasting. This package is hyper-powerful for those who are looking to speed up their service speed.</p>
<p>To install Numba, just like any other package, you use:</p>
<div class="highlight"><pre><span></span><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">numba</span>
</pre></div>


<p>To use numba, you import it using the call below, and to run Numba you simply add an @jit call before your function, for example:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>

<span class="nd">@jit</span>
</pre></div>


<p>You can use many different arguements with the Jit command as well, such as:</p>
<div class="highlight"><pre><span></span><span class="nd">@jit</span><span class="p">(</span><span class="n">nopython</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="ow">or</span> <span class="nd">@njit</span> <span class="ow">or</span> <span class="nd">@njit</span><span class="p">(</span><span class="n">fastmath</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="ow">or</span> <span class="nd">@njit</span><span class="p">(</span><span class="n">parallel</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p>Let's jump into an example and see how Numba performs.</p>
<p>First, I'm going to bring in NumPy; then, I'm going to write a primary function then I am going to add some data and see how it performs without the power of Numba.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sorting</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cur</span> <span class="o">&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">original</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">)</span>
<span class="n">shuffled</span> <span class="o">=</span> <span class="n">original</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">shuffled</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">sort_it</span> <span class="o">=</span> <span class="n">shuffled</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">sorting</span><span class="p">(</span><span class="n">sort_it</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">sort_it</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">shuffled</span><span class="p">[:];</span> <span class="n">sorting</span><span class="p">(</span><span class="n">sort_it</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">212</span> <span class="nv">ms</span> ± <span class="mi">16</span>.<span class="mi">7</span> <span class="nv">ms</span> <span class="nv">per</span> <span class="k">loop</span> <span class="ss">(</span><span class="nv">mean</span> ± <span class="nv">std</span>. <span class="nv">dev</span>. <span class="nv">of</span> <span class="mi">7</span> <span class="nv">runs</span>, <span class="mi">1</span> <span class="k">loop</span> <span class="nv">each</span><span class="ss">)</span>
</pre></div>


<p>So you can see that, without any help from Numba, the speed it took to run through that function was 212 ms, or 212000 µs, which will be valuable to know in comparing later.</p>
<p>Now its time to see what Numba can do with the same function.</p>
<div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">sorting</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cur</span> <span class="o">&gt;</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]:</span>
                <span class="n">tmp</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
                <span class="n">X</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">timeit</span> <span class="n">sort_it</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">shuffled</span><span class="p">[:];</span> <span class="n">sorting</span><span class="p">(</span><span class="n">sort_it</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="mi">389</span> µ<span class="nv">s</span> ± <span class="mi">6</span>.<span class="mi">77</span> µ<span class="nv">s</span> <span class="nv">per</span> <span class="k">loop</span> <span class="ss">(</span><span class="nv">mean</span> ± <span class="nv">std</span>. <span class="nv">dev</span>. <span class="nv">of</span> <span class="mi">7</span> <span class="nv">runs</span>, <span class="mi">1</span> <span class="k">loop</span> <span class="nv">each</span><span class="ss">)</span>
</pre></div>


<p>You can see that it took Numba 389 µs to run that function. More than 500 times faster than a function without it.</p>
<p><img alt="png" src="images/shocked.png"></p>
<p>You should be as shocked as the monkey above. That is a severe increase in speed when it comes to running functions and NumPy arrays.</p>
<p>So, take this new power with you and use it to increase your productivity!</p>
 </div>
</div>
 </div>
</body>
</html>